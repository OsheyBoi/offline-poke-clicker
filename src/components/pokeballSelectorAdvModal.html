<div class="modal fade" id="pokeballSelectorAdvModal" tabindex="-1" role="dialog"
    aria-labelledby="PokeballSelectorAdvModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header p-0" style='justify-content: space-around;'>
                <ul class="nav nav-tabs nav-fill w-100">
                    <li class="nav-item">
                        <a class="nav-link active" href="#pokeballFilterConfigTab"
                            data-toggle="tab"
                            data-bind="text: App.translation.get('pokeball.modal.filters.configure.title', 'modules')">
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#pokeballFilterTestTab"
                            data-toggle="tab"
                            data-bind="text: App.translation.get('pokeball.modal.filters.test.title', 'modules')">
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#pokeballFilterHelpTab"
                            data-toggle="tab"
                            data-bind="text: App.translation.get('pokeball.modal.filters.help.title', 'modules')">
                        </a>
                    </li>
                </ul>
            </div>
            <div class="modal-body p-0">
                <div class="tab-content">
                    <div id="pokeballFilterConfigTab" class="tab-pane active p-3">
                        <div>
                            <button class="btn btn-primary my-2 mr-2" onclick="App.game.pokeballFilters.createFilter()"
                                data-bind="text: App.translation.get('pokeball.modal.filters.configure.action.create', 'modules')">
                            </button>
                            <button class="btn btn-primary my-2" onclick="App.game.pokeballFilters.reset()"
                                data-bind="text: App.translation.get('pokeball.modal.filters.configure.action.reset', 'modules')">
                            </button>
                        </div>
                        <p class="mb-1 small">
                            **
                            <span data-bind="text: App.translation.get('pokeball.modal.filters.configure.hint.first', 'modules')">Filters closer to the</span>
                            <strong class="text-warning" data-bind="text: Settings.getSetting('catchFilters.invertPriorityOrder').observableValue()
                                ? App.translation.get('pokeball.modal.filters.configure.hint.bottom', 'modules')
                                : App.translation.get('pokeball.modal.filters.configure.hint.top', 'modules')"
                            ></strong>
                            <span data-bind="text: App.translation.get('pokeball.modal.filters.configure.hint.second', 'modules')">have a higher priority!</span>
                            **
                        </p>
                        <div id="pokeballFilterConfigs"
                            data-bind="sortable: {
                                foreach: App.game.pokeballFilters.list,
                                options: {
                                    group: 'pokeballFilters',
                                    draggable: '.pokeballFilterWrapper',
                                    handle: '.pokeballFilterDragHandle',
                                    dataIdAttr: 'data-key',
                                    getId: (filter) => filter.uuid,
                                }
                            }">
                            <div class="pokeballFilterWrapper" data-bind="
                                visible: !PokeballFilters.hideFilter($data)
                            ">
                                <div class="pokeballFilterDragHandle bg-dark text-white"></div>
                                <div class="pokeballFilter">
                                    <div class="pokeballFilterHeader">
                                        <div class="pokeballFilterEnableToggle" data-bind="
                                            tooltip: {
                                                title: $data.enabled() ? 'Enabled' : 'Disabled',
                                                trigger: 'hover',
                                                animation: false,
                                                placement: 'bottom',
                                            },
                                            template: {
                                                name: 'toggleSliderTemplate',
                                                data: {
                                                    value: $data.enabled,
                                                    key: `checkbox-enabled-${$index()}`
                                                },
                                            }
                                        "></div>
                                        <button class="btn-circle btn-info"
                                                data-bind="tooltip: {
                                                    title: () => PokeballFilter.tooltipDescription(
                                                        $data,
                                                        (key, namespace) => App.translation.get(key, namespace)(),
                                                    ),
                                                    trigger: 'hover',
                                                    animation: false,
                                                    placement: 'right',
                                                    html: true,
                                                }"
                                        >?</button>
                                        <div class="pokeballFilterName">
                                            <input class="form-control" data-bind="textInput: $data._name"></span>
                                        </div>
                                        <img class="clickable pokeball-selected pokeball-small" data-bind="
                                        attr: {
                                            src: 'assets/images/pokeball/' + GameConstants.Pokeball[$data.ball()] + '.svg'},
                                            tooltip: {
                                                title: App.translation.get(`pokeball.${GameConstants.Pokeball[$data.ball()]}.name`, 'constants'),
                                                trigger: 'hover',
                                                animation: false,
                                                placement: 'bottom'
                                            },
                                            click: function() {
                                                App.game.pokeballs.selectedSelection($data.ball);
                                                App.game.pokeballs.selectedTitle($data.name);
                                                $('#pokeballSelectorModal').modal('show')
                                            },
                                        }" />
                                    </div>
                                    <button class="pokeballFilterExpandBtn btn btn-secondary btn-block"
                                            data-toggle="collapse"
                                            data-bind="
                                                attr: { href: `#pokeball-filter-options-${$index()}` },
                                                text: App.translation.get('pokeball.modal.filters.configure.action.toggleSettings', 'modules')
                                            "
                                    ></button>
                                    <div class="collapse pokeballFilterBody"
                                        data-bind="attr: { id: `pokeball-filter-options-${$index()}`}">
                                        <table class="pokeballFilterOptions">
                                            <tbody>
                                                <!-- ko foreach: Object.entries($data.options).map(([k, v]) => ({ optionName: k, setting: v })) -->
                                                <tr>
                                                    <td>
                                                        <button class="btn-circle btn-danger"
                                                            data-bind="click: () => App.game.pokeballFilters.removeFilterOption($parent, optionName)">
                                                            <span>&minus;</span>
                                                        </button>
                                                    </td>
                                                    <!-- ko template: {
                                                    name: setting instanceof BooleanSetting ? 'pokeballFilterSlider' : 'pokeballFilterMultipleChoice',
                                                    data: { setting, key: $index() },
                                                } --><!-- /ko -->
                                                </tr>
                                                <!-- /ko -->
                                                <!-- ko foreach: Object.keys(pokeballFilterOptions).filter(k => !(k in $data.options) && pokeballFilterOptions[k].canUse()) -->
                                                <tr class="bg-faded text-white">
                                                    <td>
                                                        <button class="btn-circle btn-success"
                                                            data-bind="click: () => App.game.pokeballFilters.addFilterOption($parent, $data)">
                                                            <span>&plus;</span>
                                                        </button>
                                                    </td>
                                                    <td class="p-2"
                                                        data-bind="text: pokeballFilterOptions[$data].defaultSetting.displayName">
                                                    </td>
                                                    <td></td>
                                                </tr>
                                                <!-- /ko -->
                                                <!-- Commenting out the invert filter because it is confusing and possibly not even wanted
                                                     Can be re-enabled in a future release if we find it is wanted
                                                    tr>
                                                    <td></td>
                                                    <td class="p-2"><label class="m-0" data-bind="attr: { 'for': `checkbox-inverted-${$index()}` }">Invert Filter:</label></td>
                                                    <td class="p-2" data-bind="template: {
                                                        name: 'toggleSliderTemplate',
                                                        data: {
                                                            value: $data.inverted,
                                                            key: `checkbox-inverted-${$index()}`,
                                                        }
                                                    }"></td>
                                                </tr -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="pokeballFilterDelete">
                                    <button class="btn bg-danger text-white deleteButton"
                                        data-bind="click: () => App.game.pokeballFilters.deleteFilter($data)">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="pokeballFilterTestTab" class="tab-pane p-3">
                        <div>
                            <p data-bind="text: App.translation.get('pokeball.modal.filters.test.description', 'modules')"></p>
                        </div>
                        <div id="pokeballFilterTestInput">
                            <p data-bind="text: App.translation.get('pokeball.modal.filters.test.legend', 'modules')"></p>
                            <table>
                                <tbody data-bind="foreach: Object.entries(App.game.pokeballFilters.testSettings)
                                                                .filter(([k]) => pokeballFilterOptions[k]?.canUse() ?? true)
                                                                .map(([k, s]) => s)">
                                    <tr data-bind="template: {
                                                            name: $data instanceof BooleanSetting ? 'pokeballFilterSlider' : 'pokeballFilterMultipleChoice',
                                                            data: { setting: $data, key: `test-${$index()}` },
                                                        }"></tr>
                                </tbody>
                            </table>
                        </div>
                        <div id="pokeballFilterTestResults" data-bind="using: App.game.pokeballFilters.findMatch(
                                                                    App.game.pokeballFilters.testSettingsData()
                                                                )">
                            <p id="pokeballFilterTestMatch">
                                <span data-bind="visible: $data, text: `${App.translation.get('pokeball.modal.filters.test.result', 'modules').peek()} ${$data?.name}`"></span>
                                <span data-bind="visible: !$data, text: App.translation.get('pokeball.modal.filters.test.noResult', 'modules')"></span>
                                <!-- ko if: $data -->
                                <img class="pokeball-selected pokeball-small" data-bind="
                                    attr: {
                                        src: 'assets/images/pokeball/' + GameConstants.Pokeball[$data?.ball()] + '.svg'},
                                        tooltip: {
                                            title: App.translation.get(`pokeball.${GameConstants.Pokeball[$data.ball()]}.name`, 'constants'),
                                            trigger: 'hover',
                                            animation: false,
                                            placement: 'bottom'
                                        },
                                }" />
                                <!-- /ko -->
                            </p>
                            <div data-bind="foreach: App.game.pokeballFilters.displayList()">
                                <p data-bind="
                                    class: $data.test(App.game.pokeballFilters.testSettingsData()) ? 'bg-success text-white' : '',
                                    css: {
                                        'pokeballFilterDisabled': !$data.enabled(),
                                        'font-weight-bold': $parent === $data,
                                        'darker-25': $parent !== $data,
                                    }
                                ">
                                    <span data-bind="if: $parent === $data">*** </span>
                                    <span data-bind="text: $data.name"></span>
                                    <span data-bind="if: $parent === $data"> ***</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div id="pokeballFilterHelpTab" class="tab-pane p-3">
                        <h2 data-bind="text: App.translation.get('pokeball.modal.filters.configure.title', 'modules')"></h2>
                        <p data-bind="text: App.translation.get('pokeball.modal.filters.help.configure.paragraph1', 'modules')"></p>
                        <p>
                            <span data-bind="text: App.translation.get('pokeball.modal.filters.help.configure.paragraph2.line1', 'modules')"></span>
                            <button class="btn-circle btn-danger float-none">&minus;</button>
                            <span data-bind="text: App.translation.get('pokeball.modal.filters.help.configure.paragraph2.line2', 'modules')"></span>
                            <button class="btn-circle btn-success float-none">&plus;</button>
                            <span data-bind="text: App.translation.get('pokeball.modal.filters.help.configure.paragraph2.line3', 'modules')"></span>
                        </p>
                        <p data-bind="text: App.translation.get('pokeball.modal.filters.help.configure.paragraph3', 'modules')"></p>
                        <p data-bind="text: App.translation.get('pokeball.modal.filters.help.configure.paragraph4', 'modules')"></p>
                        <p data-bind="text: App.translation.get('pokeball.modal.filters.help.configure.paragraph5', 'modules')"></p>
                        <p>
                            <span data-bind="text: App.translation.get('pokeball.modal.filters.help.configure.paragraph6.line1', 'modules')"></span>
                            <button class="btn-circle btn-info float-none">&#8505;</button>
                            <span data-bind="text: App.translation.get('pokeball.modal.filters.help.configure.paragraph6.line2', 'modules')"></span>
                        </p>
                        <p data-bind="text: App.translation.get('pokeball.modal.filters.help.configure.paragraph7', 'modules')"></p>

                        <h2 data-bind="text: App.translation.get('pokeball.modal.filters.test.title', 'modules')"></h2>
                        <p data-bind="text: App.translation.get('pokeball.modal.filters.help.test.paragraph1', 'modules')"></p>
                        <p data-bind="text: App.translation.get('pokeball.modal.filters.help.test.paragraph2', 'modules')"></p>
                        <p data-bind="text: App.translation.get('pokeball.modal.filters.help.test.paragraph3', 'modules')"></p>
                        <p data-bind="text: App.translation.get('pokeball.modal.filters.help.test.paragraph4', 'modules')"></p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary"
                    data-dismiss="modal"
                    data-bind="text: App.translation.get('modal.action.close', 'app')"></button>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="toggleSliderTemplate">
    <!-- ko if: $data.text -->
    <label data-bind="attr: { for: $data.key }, text: $data.text"></label>
    <!-- /ko -->
    <label class="form-check-label toggler-wrapper style-1 m-auto">
        <input class="clickable" type="checkbox"
            data-bind="checked: $data.value, attr: { id: $data.key }">
        <div class="toggler-slider">
            <div class="toggler-knob"></div>
        </div>
    </label>
</script>
<script type="text/html" id="pokeballFilterSlider">
    <td class="p-2">
        <label class="m-0" data-bind="attr: { for: `checkbox-${setting.name}-${key}` }, text: `${setting.displayName}:`">
            setting name
        </label>
    </td>
    <td class="p-2">
        <label class="form-check-label toggler-wrapper style-1 m-auto">
            <input class="clickable" type="checkbox"
                data-bind="checked: setting.observableValue, attr: { id: `checkbox-${setting.name}-${key}` }">
            <div class="toggler-slider">
                <div class="toggler-knob"></div>
            </div>
        </label>
    </td>
</script>

<script type="text/html" id="pokeballFilterMultipleChoice">
    <td class="p-2" data-bind="text: `${setting.displayName}:`">setting name</td>
    <td class="p-0">
        <select class="form-control" data-bind="
            options: setting.getValidOptions(),
            optionsValue: 'value',
            optionsText: 'text',
            value: setting.observableValue
        "></select>
    </td>
</script>
