<div class="modal fade noselect" id="berryBlenderModal" tabindex="-1" role="dialog"
     aria-labelledby="berryBlenderModal"
     style="cursor:default">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div>
                <ul class="nav nav-tabs nav-fill">
                    <li class="nav-item" onclick="BlendingController.blendingModalTabSelected('blendingView')"><a data-toggle='tab' class='nav-link active' href="#blendingView">Blender</a></li>
                    <li class='nav-item' onclick="BlendingController.blendingModalTabSelected('blendingRecipeView')"><a data-toggle='tab' class='nav-link' href="#blendingRecipeView">Recipes</a></li>
                    <li class='nav-item' onclick="BlendingController.blendingModalTabSelected('blendingBuddiesView')"><a data-toggle='tab' class='nav-link' href="#blendingBuddiesView">Blending Buddies (TBD)</a></li>
                    <li class='nav-item' onclick="BlendingController.blendingModalTabSelected('blendHelpView')"><a data-toggle='tab' class='nav-link' href="#blendHelpView">Help</a></li>
                </ul>
            </div>

            <div data-bind="if: BlendingController.blendingModalTabSelected() === 'blendingRecipeView'">
                <div class="modal-header text-center">
                    <table style="width: 100%; table-layout:fixed; font-size: larger;">
                        <tr class="text-light">
                        <th class="bg-dark" colspan="5">Flavor Bank</th>
                        </tr>
                        <tr>
                            <td>Spicy</td>
                            <td>Dry</td>
                            <td>Sweet</td>
                            <td>Bitter</td>
                            <td>Sour</td>
                        </tr>
                        <tr>
                            <td data-bind="text: App.game.blending.flavorBank[0]().toLocaleString('en-US')">Spicy</td>
                            <td data-bind="text: App.game.blending.flavorBank[1]().toLocaleString('en-US')">Dry</td>
                            <td data-bind="text: App.game.blending.flavorBank[2]().toLocaleString('en-US')">Sweet</td>
                            <td data-bind="text: App.game.blending.flavorBank[3]().toLocaleString('en-US')">Bitter</td>
                            <td data-bind="text: App.game.blending.flavorBank[4]().toLocaleString('en-US')">Sour</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="modal-body tab-content p-0" style="overflow-x: hidden;">

                <div id="blendingView" class="tab-pane fade in active show">
                    
                    <div id="blenderView" class="justify-content-center no-select row">
                        
                        <div class="justify-content-center no-select col-12 col-lg-7">
                            <div class="berryBlendingListColumn mt-1 mb-1" style="overflow-y: auto;">
                                <table class="table table-hover table-sm">
                                    <thead class="thead-dark sticky-top">
                                        <tr>
                                            <th class="align-middle" rowspan="2">Berry</th>
                                            <th class="align-middle" colspan="5">Flavor</th>
                                            <th class="align-middle" rowspan="2">Smooth</th>
                                            <th class="align-middle" rowspan="2">Amount</th>
                                        </tr>
                                        <tr class="text-dark" style="font-weight: bold;">
                                            <td data-bind="style:{background: GameConstants.BerryColor[0]}">Spicy</td>
                                            <td data-bind="style:{background: GameConstants.BerryColor[5]}">Dry</td>
                                            <td data-bind="style:{background: GameConstants.BerryColor[2]}">Sweet</td>
                                            <td data-bind="style:{background: GameConstants.BerryColor[3]}">Bitter</td>
                                            <td data-bind="style:{background: GameConstants.BerryColor[4]}">Sour</td>
                                        </tr>
                                    </thead>
                                    <tbody data-bind="foreach: FarmController.getUnlockedBerryList()">
                                        <tr class="clickable"
                                            data-bind="
                                            click: function() { BlendingController.selectedBerry($data); },
                                            css: { 'bg-secondary': BlendingController.selectedBerry() === $data },
                                        ">
                                            <td style="justify-content: left;">
                                                <img height="30px" data-bind="attr: {src: FarmController.getBerryImage(App.game.farming.berryData[$data].type)}, css: { 'pokemon-not-seen': !App.game.farming.unlockedBerries[$data]() }"/>
                                                <span data-bind="text: App.game.farming.unlockedBerries[$data]() ? BerryType[$data] : ''"></span>
                                            </td>
                                            <!-- ko if: App.game.farming.unlockedBerries[$data]() -->
                                                <td data-bind="text: App.game.farming.berryData[$data].flavors[0].value,
                                                style:{background: `rgb(238, 129, 48, ${App.game.farming.berryData[$data].flavors[0].value/100})`}">Spicy</td>
                                                <td data-bind="text: App.game.farming.berryData[$data].flavors[1].value,
                                                style:{background: `rgb(99, 144, 240, ${App.game.farming.berryData[$data].flavors[1].value/100})`}">Dry</td>
                                                <td data-bind="text: App.game.farming.berryData[$data].flavors[2].value,
                                                style:{background: `rgb(214, 133, 173, ${App.game.farming.berryData[$data].flavors[2].value/100})`}">Sweet</td>
                                                <td data-bind="text: App.game.farming.berryData[$data].flavors[3].value,
                                                style:{background: `rgb(122, 199, 76, ${App.game.farming.berryData[$data].flavors[3].value/100})`}">Bitter</td>
                                                <td data-bind="text: App.game.farming.berryData[$data].flavors[4].value,
                                                style:{background: `rgb(247, 208, 44, ${App.game.farming.berryData[$data].flavors[4].value/100})`}">Sour</td>
                                                <td data-bind="text: App.game.farming.berryData[$data].smoothness"></td>
                                                <td data-bind="text: App.game.farming.berryList[$data]().toLocaleString('en-US')"></td>
                                            <!-- /ko -->
                                            <!-- ko if: !App.game.farming.unlockedBerries[$data]() -->
                                                <td colspan="6">???</td>
                                                <td></td>
                                            <!-- /ko -->
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                        </div>
                    
                        <div class="col-5">
                            <div data-bind="foreach: App.game.blending.machines">
                                <!-- ko if: $data.blendSlots.some(s => s.isUnlocked) -->
                                    <div class="mt-2 card-header p-0">
                                        <span data-bind="text: `Blender ${$index() + 1}`"></span>
                                    </div>
                                    <div>
                                        <div style="display: flex; flex-direction: row; justify-content: space-evenly;">
                                            <div>
                                                <div style="display: flex; flex-direction: row; justify-content: space-evenly;" data-bind="foreach: $data.blendSlots">
                                                    <!-- ko if: $data.isUnlocked -->
                                                    <div>
                                                        <div class="bg-secondary"
                                                        style="margin: 5px; width: 40px; height: 40px;"
                                                            data-bind="ifnot: $data.isEmpty(),
                                                            click: function(data, event){App.game.blending.insertBerry($index(), BlendingController.selectedBerry(), $parentContext.$index())},
                                                            event: { contextmenu: function(data, event){App.game.blending.insertBerry($index(), BerryType.None, $parentContext.$index())} },">
                                                            <img width="100%" height="100%" src=""
                                                                data-bind="attr:{ src: FarmController.getBerryImage($parent.blendSlots[$index()].berry)}">
                                                        </div>
                                                    </div>
                                                    <!-- /ko -->
                                                </div>
                                                <table style="width: 100%;">
                                                    <tr>
                                                    <td colspan="5">Incoming Flavors:</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Spicy</td>
                                                        <td>Dry</td>
                                                        <td>Sweet</td>
                                                        <td>Bitter</td>
                                                        <td>Sour</td>
                                                    </tr>
                                                    <tr data-bind="foreach: App.game.blending.incomingFlavors($index())">
                                                    <td data-bind="text: $data"></td>
                                                    </tr>
                                                </table>
                                            </div>
                                            <div style="display: flex; flex-direction:column; align-items: center; justify-content: center;">
                                                <div>
                                                    <img class="blenderBody" src="assets/images/contest/blenderBody.svg">
                                                    <img class="blenderTop" src="assets/images/contest/blenderTop.svg"
                                                        data-bind="attr: { style: 'rotate: ' + App.game.blending.machines[$index()].degreesRotated +'deg' }"
                                                    >
                                                </div>
                                                <div>
                                                    <div data-bind="text: `RPM: ${App.game.blending.getRPM($index())}`"></div>
                                                    <div class="progress">
                                                        <div class="progress-bar bg-success" role="progressbar"
                                                            data-bind="attr:{ style: 'width:' + App.game.blending.getTimer($index()) + '%' }"
                                                            aria-valuemin="0" aria-valuemax="100">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                <!-- /ko -->
                            </div>
                                <!-- ko if: App.game.blending.machines.some(m => m.blendSlots.some(s => !s.isUnlocked)) -->
                                    <button class="clickable btn btn-block btn-success" data-bind="
                                        css: {disabled: App.game.wallet.currencies[GameConstants.Currency.contestToken]() < App.game.blending.nextBlendingSlotCost().amount},
                                        click: App.game.blending.buyBlendingSlot()">
                                        <span data-bind="html: App.game.blending.getBlendingSlotCostDisplay()"</span>
                                    </button>
                                <!-- /ko -->
                            <div class="mt-3">
                                <table style="width: 100%; table-layout:fixed;">
                                    <tr class="text-light">
                                    <th class="bg-dark" colspan="5">Flavor Bank</th>
                                    </tr>
                                    <tr>
                                        <td>Spicy</td>
                                        <td>Dry</td>
                                        <td>Sweet</td>
                                        <td>Bitter</td>
                                        <td>Sour</td>
                                    </tr>
                                    <tr>
                                    <td data-bind="text: GameHelper.formatAmount(App.game.blending.flavorBank[0]())">Spicy</td>
                                    <td data-bind="text: GameHelper.formatAmount(App.game.blending.flavorBank[1]())">Dry</td>
                                    <td data-bind="text: GameHelper.formatAmount(App.game.blending.flavorBank[2]())">Sweet</td>
                                    <td data-bind="text: GameHelper.formatAmount(App.game.blending.flavorBank[3]())">Bitter</td>
                                    <td data-bind="text: GameHelper.formatAmount(App.game.blending.flavorBank[4]())">Sour</td>
                                </tr>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>

                <div id="blendingRecipeView" class="tab-pane fade">

                    <div class="modal-body">
                        <div>
                            <div class="row justify-content-center" data-bind="foreach: BlendingRecipes.getFullBlendingRecipeList()">
                                <div class="col-6 col-sm-4 col-lg-3">
                                <button class="shopItem clickable btn btn-block btn-secondary"
                                    data-bind="click: function() {BlendingController.selectedRecipe($data);},
                                    css: { active: BlendingController.selectedRecipe() == $data },
                                    tooltip: {
                                        title: ItemList[$data.item].description ? `<u>${ItemList[$data.item].displayName}:</u><br/>${ItemList[$data.item].description}` : '',
                                        trigger: 'hover',
                                        placement:'bottom',
                                        boundary: 'viewport',
                                        html: true
                                        }">
                                    <img src="" height="48px" style="image-rendering: pixelated;" data-bind="attr:{ src: ItemList[$data.item].image }">
                                    <p data-bind="text: ItemList[$data.item].displayName">Item Name</p>
                                        <div style="display: flex; flex-direction:column; align-items: center; justify-content: center;">
                                            <table style="width: 100%;">
                                                    <thead>
                                                        <tr>
                                                            <th class="align-middle" colspan="5" style="text-decoration: underline; font-weight: normal;">Flavor Cost</th>
                                                        </tr>
                                                        <tr class="text-dark" style="font-weight: bold;">
                                                            <!-- ko foreach: $data.flavorPrice.filter(f => f.value > 0) -->
                                                                <td data-bind="text: FlavorType[$data.type]">Flavor</td>
                                                            <!-- /ko -->
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <!-- ko foreach: $data.flavorPrice.filter(f => f.value > 0) -->
                                                                <td data-bind="text: $data.value">Value</td>
                                                            <!-- /ko -->
                                                        </tr>
                                                        <tr>
                                                            <td class="align-middle" colspan="5" data-bind="text: `Amount: ${player.itemList[$data.item]().toLocaleString('en-US')}`"></td>
                                                        </tr>
                                                    </tbody>
                                            </table>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="blendingBuddiesView" class="tab-pane fade">
                    <h4><u>Blending Buddies</u></h4>
                    <p>Blending Buddies will be able to join in and offer a random Berry from their pool to the Machine they're assigned to. Each Buddy will also contribute their own RPM to the Machine.</p>
                    <p>The berry pool of each Buddy is planned be based on berry generation.</p>
                </div>

                <div id="blendHelpView" class="tab-pane fade col-10 offset-1">
                    <h4><u>Berry Blending</u></h4>
                    <p>Blend Berries to convert them into Flavor Values, which can be used to make Pokeblocks.</p>

                    <h4><u>Recipes</u></h4>
                    <p>Recipes let you create Pokeblocks. They can be unlocked or bought in Towns that hold Contests.</p>

                    <h4><u>Blending Buddies</u></h4>
                    <p>Blending Buddies can join in and offer a random Berry from their pool to the Machine they're assigned to.</p>
                </div>
            </div>

            <div class="modal-footer">
                <div class="row m-0" style="margin-bottom: 6px; margin-top: 6px" data-bind="if: BlendingController.blendingModalTabSelected() === 'blendingView'">
                    <div class="input-group-prepend m-1">
                        <button type="button" class="btn btn-primary" onclick="App.game.blending.insertBerryAll(BlendingController.selectedBerry())"
                            data-bind="css: {disabled: !App.game.blending.hasEnoughBerries(BlendingController.selectedBerry()) }">
                            Fill All Slots
                        </button>
                        <btn id="blendBerryButton" class="btn btn-sm btn-primary px-1 py-1" onclick="BlendingController.berrySpin()">
                            <img id="blendBerry" height="28px" data-bind="
                                attr: { src: FarmController.getBerryImage(BlendingController.selectedBerry()) }"/>
                        </btn>
                    </div>
                    <button type="button" class="btn btn-primary m-1" onclick="App.game.blending.removeBerryAll()">
                        Clear All Slots
                    </button>
                </div>

                <div class="row justify-content-center" data-bind="if: BlendingController.blendingModalTabSelected() === 'blendingRecipeView'">
                    <div class="input-group m-0" style="margin-bottom: 6px; margin-top: 6px">
                        <div class="input-group-prepend">
                            <button class="btn btn-warning btn-outline-dark smallButton smallFont" onclick="BlendingController.resetAmount()">
                                Reset
                            </button>
                        </div>
                        <input id="recipeAmount" type="number" class="outline-dark form-control form-control-number"
                                value="1" min="1" required name="recipeAmount"
                                oninput="BlendingController.amount(parseInt($(this).val().toString(), 10) || 0);"
                                onchange="BlendingController.amount(parseInt($(this).val().toString(), 10) || 0);" title=""/>
                        <div class="input-group-append">
                            <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'original' -->
                                <button class="btn btn-secondary smallButton smallFont" type="button" onclick="BlendingController.increaseAmount(10)">
                                    +10
                                </button>
                                <button class="btn btn-secondary smallButton smallFont" type="button" onclick="BlendingController.increaseAmount(100)">
                                    +100
                                </button>
                            <!-- /ko -->
                            <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'multiplication' -->
                                <button class="btn btn-secondary smallButton smallFont" type="button" onclick="BlendingController.multiplyAmount(10)">
                                    &times;10
                                </button>
                                <button class="btn btn-secondary smallButton smallFont" type="button" onclick="BlendingController.multiplyAmount(0.1)">
                                    &div;10
                                </button>
                            <!-- /ko -->
                            <!-- ko if: Settings.getSetting('shopButtons').observableValue() == 'bigplus' -->
                                <button class="btn btn-secondary smallButton smallFont" type="button" onclick="BlendingController.increaseAmount(100)">
                                    +100
                                </button>
                                <button class="btn btn-secondary smallButton smallFont" type="button" onclick="BlendingController.increaseAmount(1000)">
                                    +1,000
                                </button>
                            <!-- /ko -->
                            <button class="btn btn-primary smallButton smallFont" type="button" onclick="BlendingController.maxAmount()">
                                Max
                            </button>
                            <button class="btn-outline-dark" data-bind="attr: {class: BlendingController.calculateButtonCss()}" onclick="App.game.blending.buyPokeblock(BlendingController.selectedRecipe(), BlendingController.amount())">
                                Buy
                            </button>
                        </div>
                    </div>
                </div>

                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>


        </div>
    </div>
</div>

